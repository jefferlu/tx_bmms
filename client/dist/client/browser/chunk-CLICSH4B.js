import{a as f}from"./chunk-XBMGUK3Y.js";import{Bc as v,Ga as _,Gc as m,Mc as D,X as w,_ as S,ba as d,ga as u,o as I,oc as E,s as l,t as b,w as C}from"./chunk-LSX3DIYH.js";var g=class{constructor(){}static isTokenExpired(t,r){if(!t||t==="")return!0;let e=this._getTokenExpirationDate(t);return r=r||0,e===null?!0:!(e.valueOf()>new Date().valueOf()+r*1e3)}static _b64decode(t){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="";if(t=String(t).replace(/=+$/,""),t.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let i=0,o,s,a=0;s=t.charAt(a++);~s&&(o=i%4?o*64+s:s,i++%4)?e+=String.fromCharCode(255&o>>(-2*i&6)):0)s=r.indexOf(s);return e}static _b64DecodeUnicode(t){return decodeURIComponent(Array.prototype.map.call(this._b64decode(t),r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))}static _urlBase64Decode(t){let r=t.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:{r+="==";break}case 3:{r+="=";break}default:throw Error("Illegal base64url string!")}return this._b64DecodeUnicode(r)}static _decodeToken(t){if(!t)return null;let r=t.split(".");if(r.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let e=this._urlBase64Decode(r[1]);if(!e)throw new Error("Cannot decode the token.");return JSON.parse(e)}static _getTokenExpirationDate(t){let r=this._decodeToken(t);if(!r.hasOwnProperty("exp"))return null;let e=new Date(0);return e.setUTCSeconds(r.exp),e}};var y=f.user_key,U=(()=>{let t=class t{constructor(e){this._httpClient=e,this._user=new I(1)}set user(e){localStorage.setItem(y,JSON.stringify(e)),this._user.next(e)}get user$(){let e=localStorage.getItem(y);return this._user.next(e?JSON.parse(e):""),this._user.asObservable()}get(){return this._httpClient.get("api/common/user").pipe(S(e=>{this._user.next(e)}))}update(e){return this._httpClient.patch("api/common/user",{user:e}).pipe(C(i=>{this._user.next(i)}))}};t.\u0275fac=function(i){return new(i||t)(u(m))},t.\u0275prov=d({token:t,factory:t.\u0275fac,providedIn:"root"});let c=t;return c})();var j=(()=>{let t=class t{constructor(e,i){this.document=e,this.platformId=i,this.documentIsAccessible=v(this.platformId)}static getCookieRegExp(e){let i=e.replace(/([\[\]{}()|=;+?,.*^$])/gi,"\\$1");return new RegExp("(?:^"+i+"|;\\s*"+i+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(e){try{return decodeURIComponent(e)}catch{return e}}check(e){return this.documentIsAccessible?(e=encodeURIComponent(e),t.getCookieRegExp(e).test(this.document.cookie)):!1}get(e){if(this.documentIsAccessible&&this.check(e)){e=encodeURIComponent(e);let o=t.getCookieRegExp(e).exec(this.document.cookie);return o[1]?t.safeDecodeURIComponent(o[1]):""}else return""}getAll(){if(!this.documentIsAccessible)return{};let e={},i=this.document;return i.cookie&&i.cookie!==""&&i.cookie.split(";").forEach(o=>{let[s,a]=o.split("=");e[t.safeDecodeURIComponent(s.replace(/^ /,""))]=t.safeDecodeURIComponent(a)}),e}set(e,i,o,s,a,h,k,R){if(!this.documentIsAccessible)return;if(typeof o=="number"||o instanceof Date||s||a||h||k){let x={expires:o,path:s,domain:a,secure:h,sameSite:k||"Lax",partitioned:R};this.set(e,i,x);return}let p=encodeURIComponent(e)+"="+encodeURIComponent(i)+";",n=o||{};if(n.expires)if(typeof n.expires=="number"){let x=new Date(new Date().getTime()+n.expires*1e3*60*60*24);p+="expires="+x.toUTCString()+";"}else p+="expires="+n.expires.toUTCString()+";";n.path&&(p+="path="+n.path+";"),n.domain&&(p+="domain="+n.domain+";"),n.secure===!1&&n.sameSite==="None"&&(n.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${e} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),n.secure&&(p+="secure;"),n.sameSite||(n.sameSite="Lax"),p+="sameSite="+n.sameSite+";",n.partitioned&&(p+="Partitioned;"),this.document.cookie=p}delete(e,i,o,s,a="Lax"){if(!this.documentIsAccessible)return;let h=new Date("Thu, 01 Jan 1970 00:00:01 GMT");this.set(e,"",{expires:h,path:i,domain:o,secure:s,sameSite:a})}deleteAll(e,i,o,s="Lax"){if(!this.documentIsAccessible)return;let a=this.getAll();for(let h in a)a.hasOwnProperty(h)&&this.delete(h,e,i,o,s)}};t.\u0275fac=function(i){return new(i||t)(u(E),u(_))},t.\u0275prov=d({token:t,factory:t.\u0275fac,providedIn:"root"});let c=t;return c})();var P=f.host,$=f.user_key,W=(()=>{let t=class t{constructor(e,i,o,s){this._httpClient=e,this._userService=i,this._cookieService=o,this._sanitizer=s,this._authenticated=!1}set token(e){this._cookieService.set("access",e.access)}get accessToken(){return localStorage.getItem("accessToken")??""}forgotPassword(e){return this._httpClient.post("api/auth/forgot-password",e)}resetPassword(e){return this._httpClient.post("api/auth/reset-password",e)}signIn(e){return this._authenticated?b("User is already logged in."):this._httpClient.post(`${P}/api/login`,e).pipe(w(i=>(this.token=i,this._authenticated=!0,this._userService.user=i.user,l(i))))}signOut(){return localStorage.removeItem($),this._cookieService.deleteAll(),this._authenticated=!1,l(!0)}signUp(e){return this._httpClient.post("api/auth/sign-up",e)}unlockSession(e){return this._httpClient.post("api/auth/unlock-session",e)}check(){return this._authenticated?l(!0):this._cookieService.get("access")?g.isTokenExpired(this._cookieService.get("access"))?l(!1):l(!0):l(!1)}};t.\u0275fac=function(i){return new(i||t)(u(m),u(U),u(j),u(D))},t.\u0275prov=d({token:t,factory:t.\u0275fac,providedIn:"root"});let c=t;return c})();export{U as a,g as b,j as c,W as d};
