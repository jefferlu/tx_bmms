<div class="absolute inset-0 flex min-w-0 flex-col overflow-hidden h-full">
    <mat-drawer-container class="flex-auto dark:bg-transparent" (backdropClick)="onCloseDrawer()">
        <mat-drawer class="w-full dark:bg-gray-900 sm:w-120" [mode]="drawerMode" [opened]="false" [position]="'end'" [disableClose]="true" #matDrawer>
            <ng-container *ngTemplateOutlet="content"></ng-container>
        </mat-drawer>

        <mat-drawer-content>
            <div class="flex flex-auto flex-col h-full bg-white dark:bg-gray-900 p-6" *transloco="let t">

                <!-- Header -->
                <div class="flex flex-row items-center justify-between px-6 py-8 md:px-8">
                    <!-- Title -->
                    <div class="text-3xl font-extrabold leading-none tracking-tight">
                        {{t('user-group')}}
                    </div>

                    <!-- Actions -->
                    <div>
                        <button mat-stroked-button (click)="onOpenDrawer()">
                            <mat-icon [svgIcon]="'heroicons_outline:plus-circle'"></mat-icon>
                            <span class="ml-2 mr-1">{{t('create')}} {{t('auth-group')}}</span>
                        </button>
                    </div>

                </div>

                <!-- Content -->
                <div class="flex h-full overflow-y-auto  bg-card rounded-md">
                    @if(page.data){
                    <p-table class="w-full" [value]="page.data" [scrollable]="true" scrollHeight="flex" [styleClass]="'p-datatable-lg'" selectionMode="single"
                        [metaKeySelection]="true" (onRowSelect)="onOpenDrawer($event)">
                        <ng-template pTemplate="header">
                            <tr>
                                <th class="pl-8 py-4">{{t('name')}}</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-d>
                            <tr [pSelectableRow]="d" class="hover:bg-hover">
                                <td class="pl-8">{{ d.name }}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                    }
                    @else {
                    <div class="flex flex-auto flex-col items-center justify-center text-secondary mb-10">
                        <mat-icon class="icon-size-16" [svgIcon]="'heroicons_outline:exclamation-circle'"></mat-icon>
                        <div class="mt-4 text-xl font-semibold tracking-tight">
                            {{t('no-data-found')}}
                        </div>
                    </div>
                    }
                </div>
            </div>
        </mat-drawer-content>

    </mat-drawer-container>
</div>

<ng-template #content>
    <div class="flex flex-auto h-full" *transloco="let t">
        <div class="flex flex-auto flex-col overflow-y-auto">
            <!-- Header -->
            <div class="flex items-center justify-between px-6 py-3">
                <mat-icon [svgIcon]="'heroicons_outline:window'"></mat-icon>
                <span class="text-xl">
                    @if(page.record?.id){ {{ t('edit') }} {{ t('auth-group') }} }
                    @else{ {{ t('create') }} {{ t('auth-group') }} }
                </span>

                <div class="flex">
                    <!-- Close button -->
                    <button type="button" mat-icon-button (click)="onCloseDrawer()">
                        <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                    </button>
                </div>
            </div>

            <mat-divider></mat-divider>

            <form class="p-8" #ngForm="ngForm">

                <!-- Name -->
                <div class="mt-2">
                    <mat-form-field class="flex-auto w-full gts-mat-dense">
                        <mat-label>{{ t('name') }}</mat-label>
                        <!-- <mat-icon matPrefix class="hidden sm:flex icon-size-5" [svgIcon]="'heroicons_outline:user'"></mat-icon> -->
                        <input name="name" matInput [spellcheck]="false" [(ngModel)]="page.name" required>
                    </mat-form-field>
                </div>

                <!-- Permission -->
                @for (r of page.restruct; track trackByFn($index, r)) {
                <div class="bg-card flex flex-col overflow-hidden rounded-xl mb-3">

                    <div class="flex flex-col p-6">
                        <div class="pb-2 mt-0.5 line-clamp-2 text-xl text-primary-300">{{ r.name }}</div>

                        @for (permission of r.permissions; track trackByFn($index, permission)) {
                        <div class="flex items-center justify-between pt-2">
                            <div>
                                <label class="pb-1 block"> {{ permission.name }} {{permission.codename}} </label>
                                <div class="pb-2 text-secondary mt-0.5 line-clamp-2 text-sm">{{ permission.desc }}</div>
                            </div>
                            <p-toggleswitch [name]="permission.codename" [(ngModel)]="permission.status"></p-toggleswitch>
                        </div>
                        }
                    </div>

                </div>
                }

                <!-- Edit Actions -->
                <div class="flex items-center justify-between mt-4 mb-2">
                    @if(isLoading){
                    <mat-progress-spinner class="mx-auto" [diameter]="24" [mode]="'indeterminate'"></mat-progress-spinner>
                    }

                    @else{
                    <!-- Delete -->
                    <div class="flex items-center space-x-2">
                        @if(page?.record?.id){
                        <button [color]="'warn'" mat-flat-button (click)="onDelete()">
                            <mat-icon class="pr-2" [svgIcon]="'heroicons_outline:trash'"></mat-icon>{{ t('delete') }}
                        </button>
                        }
                    </div>

                    <!-- Save -->
                    <div>
                        <button mat-flat-button [color]="'primary'" class="mr-2" (click)="onSave()" [disabled]="ngForm.invalid || isLoading">
                            <mat-icon class="pr-2" [svgIcon]="'heroicons_outline:bookmark-square'"></mat-icon>{{ t('save') }}
                        </button>
                    </div>
                    }
                </div>
            </form>

        </div>
    </div>
</ng-template>